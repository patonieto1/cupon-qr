<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cupón especial CÉLINE</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="card">
    <!-- Banner / Marca -->
    <header class="brand">
      <div class="brand__logo">CÉLINE</div>
      <div class="brand__tag">POP-UP CAFÉ BAR · C’est la vie</div>
    </header>

    <section class="hero">
      <h1 class="hero__title">Cupón especial</h1>
      <p class="hero__sub">Completa tus datos (15 segundos) y recibe tu cupón al instante.</p>
    </section>

    <form id="f" class="form">
      <label class="label" for="nombre">Nombre y apellido</label>
      <input id="nombre" name="nombre" class="input" placeholder="Ej. Juan Pérez" required autocomplete="name" />

      <label class="label" for="celular">Celular</label>
      <input id="celular" name="celular" class="input" placeholder="Ej. 0991234567" required inputmode="numeric" autocomplete="tel" />

      <label class="label" for="red">Red favorita</label>
      <select id="red" name="red" class="input" required>
        <option value="Instagram" selected>Instagram</option>
        <option value="TikTok">TikTok</option>
        <option value="Facebook">Facebook</option>
        <option value="WhatsApp">WhatsApp</option>
        <option value="Otra">Otra</option>
      </select>

      <label class="label" for="usuario">@usuario o link (opcional)</label>
      <input id="usuario" name="usuario" class="input" placeholder="@tuusuario" autocomplete="off" />

      <button id="btn" class="btn" type="submit">Obtener cupón</button>

      <p class="fineprint">
        Al enviar aceptas que CÉLINE use estos datos solo para esta promoción y novedades.
      </p>
    </form>

    <!-- Cupón (oculto hasta enviar) -->
    <section id="cup" class="coupon hidden" aria-live="polite">
      <div class="coupon__top">
        <div class="coupon__badge">CUPÓN</div>
        <div class="coupon__code" id="code">CELINE-XXXX</div>
      </div>

      <div class="coupon__body">
        <div class="coupon__title">Beneficio exclusivo</div>
        <div class="coupon__desc" id="benefit">Beneficio exclusivo disponible en barra.</div>
        <div class="coupon__meta">Presenta este cupón en caja</div>
      </div>

      <button class="btn btn--ghost" id="copy" type="button">Copiar código</button>
    </section>
  </main>

  <script>
    // ====== CONFIG ======
    // Pega aquí luego tu endpoint de Google Sheets / Apps Script
    const ENDPOINT = ""; // ejemplo: "https://script.google.com/macros/s/XXXXX/exec"

    // Beneficio (general - Opción A)
    const COUPON_BENEFIT = "Beneficio exclusivo disponible en barra.";

    // ====== LOGIC ======
    const f = document.getElementById("f");
    const cup = document.getElementById("cup");
    const codeEl = document.getElementById("code");
    const benefitEl = document.getElementById("benefit");
    const copyBtn = document.getElementById("copy");

    function makeCode() {
      // Código simple, corto y fácil de leer
      const part = Math.random().toString(36).slice(2, 6).toUpperCase();
      return "CELINE-" + part;
    }

    async function saveToSheet(payload) {
      // Si todavía no configuraste ENDPOINT, igual funciona y solo muestra el cupón
      if (!ENDPOINT) return { ok: true, skipped: true };

      const res = await fetch(ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      // Algunos Apps Script devuelven texto; intentamos JSON y si no, devolvemos ok
      try {
        return await res.json();
      } catch {
        return { ok: res.ok };
      }
    }

    f.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        nombre: f.nombre.value.trim(),
        celular: f.celular.value.trim(),
        red: f.red.value,
        usuario: f.usuario.value.trim(),
        codigo: makeCode(),
        beneficio: COUPON_BENEFIT,
        fecha: new Date().toISOString(),
      };

      // UI
      benefitEl.textContent = data.beneficio;
      codeEl.textContent = data.codigo;

      // Guardar (si ya tienes endpoint)
      try { await saveToSheet(data); } catch (err) {}

      // Mostrar cupón
      cup.classList.remove("hidden");
      cup.scrollIntoView({ behavior: "smooth", block: "start" });
    });

    copyBtn.addEventListener("click", async () => {
      const text = codeEl.textContent;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = "¡Copiado!";
        setTimeout(() => (copyBtn.textContent = "Copiar código"), 1200);
      } catch {
        alert("Copia este código: " + text);
      }
    });
  </script>
</body>
</html>

