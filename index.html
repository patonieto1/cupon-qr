<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CÉLINE — Cupón Especial</title>

  <style>
    :root{
      --bg:#0b0b0c;
      --card:rgba(255,255,255,.08);
      --card2:rgba(255,255,255,.06);
      --text:#f2f2f2;
      --muted:rgba(255,255,255,.72);
      --line:rgba(255,255,255,.14);
      --btn:#ffffff;
      --btnText:#0b0b0c;
      --shadow: 0 20px 60px rgba(0,0,0,.55);
      --gold: rgba(208, 177, 120, .95);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(900px 600px at 90% 30%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, #0b0b0c 0%, #0b0b0c 60%, #090909 100%);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px 14px;
    }
    .wrap{width:100%; max-width:560px;}
    .card{
      background: linear-gradient(180deg, var(--card) 0%, var(--card2) 100%);
      border:1px solid var(--line);
      border-radius:20px;
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(14px);
    }

    .banner{
      width:100%;
      height:150px;
      background:
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.65)),
        url("BANER.jpeg");
      background-size: cover;
      background-position: center;
      display:flex;
      align-items:flex-end;
      padding:18px 18px 16px;
      border-bottom:1px solid var(--line);
    }
    .brand .title{
      font-weight:800;
      letter-spacing:.22em;
      text-transform:uppercase;
      font-size:18px;
    }
    .brand .sub{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.12em;
      text-transform:uppercase;
    }

    .content{padding:18px;}
    h1{margin:6px 0 8px; font-size:28px;}
    p{margin:0 0 14px; color:var(--muted); font-size:14px; line-height:1.45}

    .grid{display:grid; gap:12px; margin-top:8px;}
    .row2{display:grid; grid-template-columns: 1fr 1fr; gap:12px;}

    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px; letter-spacing:.06em}
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    input::placeholder{color:rgba(255,255,255,.45)}
    input:focus, select:focus{border-color:rgba(255,255,255,.30)}
    select option{color:#111}

    .btn{
      margin-top:12px;
      width:100%;
      padding:13px 14px;
      border:0;
      border-radius:14px;
      background:var(--btn);
      color:var(--btnText);
      font-weight:900;
      letter-spacing:.06em;
      cursor:pointer;
      transition: transform .06s ease, opacity .2s ease;
    }
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .btn:active{transform: scale(.99)}
    .btn.ghost{
      background: transparent;
      color: var(--text);
      border:1px solid var(--line);
      margin-top:10px;
    }

    .fine{
      margin-top:12px;
      font-size:12px;
      color:rgba(255,255,255,.55);
      line-height:1.35
    }
    .status{
      margin-top:10px;
      font-size:13px;
      color:rgba(255,255,255,.86);
      display:none;
    }

    /* CUPÓN VISUAL */
    .couponWrap{
      display:none;
      padding:18px;
      border-top:1px solid var(--line);
      background: rgba(0,0,0,.25);
    }
    .coupon{
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      background:
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.75)),
        url("BANER.jpeg");
      background-size: cover;
      background-position: center;
      padding:18px;
      position:relative;
    }
    .coupon::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(800px 280px at 20% 0%, rgba(208,177,120,.18), transparent 55%);
      pointer-events:none;
    }
    .couponTop{
      position:relative;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
    }
    .couponBrand{
      font-weight:900;
      letter-spacing:.22em;
      text-transform:uppercase;
      font-size:16px;
    }
    .couponTag{
      margin-top:6px;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(255,255,255,.75);
    }
    .badge{
      position:relative;
      border:1px solid rgba(208,177,120,.55);
      color: var(--gold);
      padding:8px 10px;
      border-radius:999px;
      font-weight:800;
      letter-spacing:.12em;
      font-size:11px;
      background: rgba(0,0,0,.25);
      white-space:nowrap;
    }
    .codeBox{
      position:relative;
      margin-top:16px;
      padding:14px 14px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.35);
      background: rgba(0,0,0,.30);
      text-align:center;
    }
    .code{
      font-size:26px;
      font-weight:1000;
      letter-spacing:.16em;
    }
    .couponMeta{
      position:relative;
      margin-top:12px;
      display:grid;
      gap:6px;
      color:rgba(255,255,255,.78);
      font-size:12px;
      line-height:1.35;
    }
    .smallLine{
      opacity:.85;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="banner">
        <div class="brand">
          <div class="title">CÉLINE</div>
          <div class="sub">POP-UP CAFÉ BAR • C’est la vie</div>
        </div>
      </div>

      <div class="content">
        <h1>Cupón de beneficio</h1>
        <p>Completa tus datos y genera tu cupón. Presenta el cupón en caja para validación.</p>

        <form id="f">
          <div class="grid">
            <div>
              <label for="nombre">NOMBRE Y APELLIDO</label>
              <input id="nombre" placeholder="Ej. Juan Pérez" required />
            </div>

            <div class="row2">
              <div>
                <label for="pais">PAÍS (WHATSAPP)</label>
                <select id="pais" required>
                  <option value="">Selecciona…</option>
                  <option value="Ecuador">Ecuador (+593)</option>
                  <option value="Estados Unidos">Estados Unidos (+1)</option>
                  <option value="Colombia">Colombia (+57)</option>
                  <option value="Perú">Perú (+51)</option>
                  <option value="España">España (+34)</option>
                  <option value="Otro">Otro</option>
                </select>
              </div>

              <div>
                <label for="codigo_pais">CÓDIGO PAÍS</label>
                <input id="codigo_pais" placeholder="+593" required />
              </div>
            </div>

            <div>
              <label for="celular">WHATSAPP (NÚMERO)</label>
              <input id="celular" placeholder="Ej. 0991234567" inputmode="tel" required />
            </div>

            <div>
              <label for="email">CORREO</label>
              <input id="email" type="email" placeholder="Ej. nombre@gmail.com" required />
            </div>

            <div>
              <label for="red">RED FAVORITA</label>
              <select id="red" required>
                <option value="">Selecciona…</option>
                <option value="Instagram">Instagram</option>
                <option value="TikTok">TikTok</option>
              </select>
            </div>

            <div>
              <label for="usuario">USUARIO REAL / LINK</label>
              <input id="usuario" placeholder="@tuusuario o link" required />
              <p class="fine" style="margin:8px 0 0">Debe ser real: <b>@usuario</b> o un link válido (https://...)</p>
            </div>

            <button class="btn" id="btn" type="submit">GENERAR CUPÓN</button>
            <div class="status" id="status"></div>

            <div class="fine">
              Al enviar aceptas que <b>CÉLINE</b> use estos datos solo para esta promoción y novedades.
            </div>
          </div>
        </form>
      </div>

      <!-- CUPÓN VISUAL -->
      <div class="couponWrap" id="couponWrap">
        <div class="coupon" id="couponCard">
          <div class="couponTop">
            <div>
              <div class="couponBrand">CÉLINE</div>
              <div class="couponTag">CUPÓN ESPECIAL</div>
            </div>
            <div class="badge">VÁLIDO</div>
          </div>

          <div class="codeBox">
            <div class="code" id="couponCode">99A-XXXXX-01Z</div>
          </div>

          <div class="couponMeta">
            <div class="smallLine" id="couponName">Cliente: —</div>
            <div class="smallLine" id="couponSocial">Red: —</div>
            <div class="smallLine">Presenta este cupón en caja para validar tu beneficio.</div>
          </div>
        </div>

        <button class="btn ghost" id="newBtn" type="button">HACER OTRO CUPÓN</button>
        <p class="fine" style="margin:10px 0 0">Tip: puedes hacer captura de pantalla del cupón para guardarlo.</p>
      </div>
    </div>
  </div>

  <script>
    // ✅ TU URL /exec (Google Apps Script)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxuqU7JeMiO8e1XSjNMsvqWrTEeefNWSaRNAmT4SZSVxZRyTz6gSSggypQpAILVyjGSkQ/exec";

    // Auto código país
    const paisSel = document.getElementById("pais");
    const codInp  = document.getElementById("codigo_pais");
    const codes = { "Ecuador":"+593","Estados Unidos":"+1","Colombia":"+57","Perú":"+51","España":"+34" };
    paisSel.addEventListener("change", () => {
      const p = paisSel.value;
      if (codes[p]) codInp.value = codes[p];
      if (p === "Otro") codInp.value = "";
    });

    // Validación básica de usuario/link
    function isValidUserOrLink(v){
      const s = (v || "").trim();
      if (!s) return false;
      const isHandle = /^@[a-zA-Z0-9._]{2,30}$/.test(s);
      const isUrl = /^https?:\/\/[^\s]+$/i.test(s);
      return isHandle || isUrl;
    }

    // ===== TRAMPA (patrón secreto para staff) =====
    // Código con pares complementarios:
    //   Prefijo: NN + Letra (ej: 99A)
    //   Sufijo:  (100-NN) + Letra espejo (A<->Z, B<->Y, etc.) (ej: 01Z)
    // Staff valida rápido: NN + sufijo_num = 100 y letra + sufijo_letra = espejo.
    function makeTrapCode(){
      const n = Math.floor(Math.random() * 99) + 1;           // 1..99
      const letterIndex = Math.floor(Math.random() * 26);      // 0..25

      const prefixNum = String(n).padStart(2,"0");
      const prefixLetter = String.fromCharCode(65 + letterIndex);

      const suffixNum = String(100 - n).padStart(2,"0");
      const suffixLetter = String.fromCharCode(90 - letterIndex); // espejo (Z - index)

      // middle: 5 chars base32 (sin 0/O/1/I)
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let mid = "";
      for (let i=0;i<5;i++) mid += chars[Math.floor(Math.random()*chars.length)];

      return `${prefixNum}${prefixLetter}-${mid}-${suffixNum}${suffixLetter}`;
    }

    // UI refs
    const form = document.getElementById("f");
    const btn = document.getElementById("btn");
    const statusEl = document.getElementById("status");

    const couponWrap = document.getElementById("couponWrap");
    const couponCodeEl = document.getElementById("couponCode");
    const couponNameEl = document.getElementById("couponName");
    const couponSocialEl = document.getElementById("couponSocial");
    const newBtn = document.getElementById("newBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nombre = document.getElementById("nombre").value.trim();
      const pais = paisSel.value.trim();
      const codigo_pais = codInp.value.trim();
      const celular = document.getElementById("celular").value.trim();
      const email = document.getElementById("email").value.trim();
      const red = document.getElementById("red").value.trim();
      const usuario = document.getElementById("usuario").value.trim();

      if (!nombre || !pais || !codigo_pais || !celular || !email || !red || !usuario) {
        alert("Por favor completa todos los campos.");
        return;
      }
      if (!codigo_pais.startsWith("+")) {
        alert("El código país debe iniciar con + (ej: +593).");
        return;
      }
      if (!isValidUserOrLink(usuario)) {
        alert("El usuario debe ser real: @usuario o un link válido (https://...)");
        return;
      }

      // Generar cupón con trampa
      const cupon = makeTrapCode();

      // Guardar en Google Sheets
      const payload = {
        cupon,
        nombre,
        pais,
        codigo_pais,
        celular,
        email,
        red,
        usuario,
        origen: window.location.href
      };

      btn.disabled = true;
      statusEl.style.display = "block";
      statusEl.textContent = "Generando…";

      try{
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(payload)
        });

        const out = await res.json();

        if (out && out.ok) {
          statusEl.textContent = "✅ Cupón generado y guardado.";

          // Mostrar cupón visual (imagen/arte)
          couponCodeEl.textContent = cupon;
          couponNameEl.textContent = `Cliente: ${nombre}`;
          couponSocialEl.textContent = `Red: ${red} · ${usuario}`;

          // UI toggle
          form.style.display = "none";
          document.querySelector(".content").style.display = "none";
          couponWrap.style.display = "block";
        } else {
          statusEl.textContent = "❌ No se pudo guardar. Revisa Apps Script.";
          console.log(out);
          alert("No se pudo guardar. Revisa Apps Script.");
        }
      } catch(err){
        console.error(err);
        statusEl.textContent = "❌ Error de conexión. Reintenta.";
        alert("Error de conexión. Reintenta.");
      } finally {
        btn.disabled = false;
      }
    });

    newBtn.addEventListener("click", () => {
      // volver al formulario
      couponWrap.style.display = "none";
      document.querySelector(".content").style.display = "block";
      form.style.display = "block";
      form.reset();
      statusEl.style.display = "none";
      statusEl.textContent = "";
      // default
      codInp.value = "";
    });
  </script>
</body>
</html>

