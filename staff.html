<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CÃ‰LINE â€” ValidaciÃ³n Staff</title>
  <style>
    :root{--bg:#0a0b0d;--panel:rgba(17,19,23,.92);--text:#f2f4f7;--muted:#a6adb9;--line:rgba(255,255,255,.12);--gold:rgba(230,214,168,.95);}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);
      display:flex;align-items:center;justify-content:center;padding:24px;}
    .card{width:min(560px,100%);background:var(--panel);border:1px solid var(--line);border-radius:20px;overflow:hidden;padding:18px;}
    .title{font-weight:900;letter-spacing:2px;color:var(--gold);text-transform:uppercase;margin-bottom:10px}
    .code{font-size:32px;font-weight:1000;letter-spacing:3px;text-align:center;margin:10px 0 14px}
    .row{display:flex;gap:10px;margin-top:12px}
    button{flex:1;padding:12px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.20);color:#fff;font-weight:900;cursor:pointer}
    .msg{margin-top:12px;color:var(--muted);text-align:center}
    .small{margin-top:10px;font-size:12px;opacity:.75;text-align:center}
  </style>
</head>
<body>
  <div class="card">
    <div class="title">ValidaciÃ³n Staff</div>
    <div class="code" id="code">â€”</div>
    <div class="msg" id="msg">Listo para revisar/canjear.</div>

    <div class="row">
      <button onclick="openCheck()">Revisar estado</button>
      <button onclick="openRedeem()">Marcar como usado</button>
    </div>

    <div class="small">âœ… Esto registra en Google Sheet. Solo staff con PIN puede canjear.</div>
  </div>

<script>
  // ðŸ”¥ Pega aquÃ­ TU WEB APP /exec FINAL (el nuevo que funciona)
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxB99bH4wyu8phnABAiT9Uapg9Nkh6NwlHIfPOltMg2hqDkvVN-CwYSzfzYvffXVfY2hA/exec";

  const params = new URLSearchParams(location.search);
  const c = (params.get("c") || "").trim();
  document.getElementById("code").textContent = c || "â€”";

  function openCheck(){
    if(!c) return alert("Falta cÃ³digo.");
    const url = `${SCRIPT_URL}?action=check&c=${encodeURIComponent(c)}`;
    window.open(url, "_blank");
    document.getElementById("msg").textContent = "âœ… Estado solicitado. (Si quieres ver el resultado exacto, abre el JSON en una pestaÃ±a)";
  }

  function openRedeem(){
    if(!c) return alert("Falta cÃ³digo.");
    const pin = prompt("PIN de caja:");
    if(!pin) return;

    const url = `${SCRIPT_URL}?action=redeem&c=${encodeURIComponent(c)}&pin=${encodeURIComponent(pin)}`;
    // ABRIMOS DIRECTO (sin fetch) para evitar CORS y bloqueos
    window.open(url, "_blank");
    document.getElementById("msg").textContent = "âœ… Canje solicitado. Revisa el JSON en la pestaÃ±a abierta y luego mira el Sheet.";
  }
</script>
</body>
</html>
